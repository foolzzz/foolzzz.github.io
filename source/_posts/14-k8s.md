---
title: 14-k8s
date: 2023-06-25 17:50:58
tags:
---

# k8såŸºç¡€

## æ¦‚å¿µä¸å®šä¹‰

- APIServer

- Controller-Manager
é›†ç¾¤çŠ¶æ€ç®¡ç†ï¼Œä¿è¯Podå¯ç”¨ï¼Œå’ŒAPIServeré€šä¿¡ï¼Œè´Ÿè´£åˆ›å»º/æ›´æ–°/åˆ é™¤èµ„æºã€‚

- Scheduler
è°ƒåº¦ä¸­å¿ƒï¼Œæ ¹æ®ä¸€ç³»åˆ—æ¡ä»¶ï¼Œé€‰æ‹©èŠ‚ç‚¹ï¼Œéƒ¨ç½²pod

- ETCD
é”®å€¼æ•°æ®åº“

- NODE

- kubelet
è´Ÿè´£ç›‘å¬å’Œä¸ŠæŠ¥èŠ‚ç‚¹ä¸Šçš„PodçŠ¶æ€ï¼Œ ä¸MasterèŠ‚ç‚¹é€šä¿¡å¹¶ç®¡ç†ä¸Šé¢çš„pod

- kube-proxy
è´Ÿè´£podä¹‹é—´çš„é€šä¿¡å’Œè´Ÿè´£å‡è¡¡ï¼Œå°†æŒ‡å®šçš„æµé‡åˆ†å‘åˆ°åç«¯æ­£ç¡®çš„æœºå™¨ä¸Š.

- ipvs / iptables
ipvs è°ƒç”¨ netlinkæ¥å£ åˆ›å»ºipvsè§„åˆ™ã€‚

- calico
ç¬¦åˆCNIæ ‡å‡†çš„ç½‘ç»œæ’ä»¶, ç»™æ¯ä¸€ä¸ªpodç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„IPåœ°å€ï¼Œå¹¶æŠŠæ¯ä¸ªèŠ‚ç‚¹å½“ä½œä¸€ä¸ªè·¯ç”±ã€‚

- CoreDNS
k8så†…éƒ¨é›†ç¾¤serviceè§£æ, å°†serviceåç§°è§£ææˆIPåœ°å€ï¼Œç„¶åé€šè¿‡serviceçš„IPåœ°å€ğŸ”—åˆ°å¯¹åº”çš„åº”ç”¨ä¸Šã€‚

- Metrics-Server
é‡‡é›†å®¹å™¨æ•°æ®


- pod
- service

- deployment
æ— çŠ¶æ€åº”ç”¨éƒ¨ç½²

- statefulset
æœ‰çŠ¶æ€åº”ç”¨éƒ¨ç½²

- daemonset

## å¸¸ç”¨å‘½ä»¤

### pod
kubectl get pod pod-name -o yaml > pod-name.yaml

### deployment
kubectl create deploy web --image=nginx -oyaml --dry-run=client > web-deploy.yaml åˆ›å»º
kubectl get deploy web -oyaml > web-deploy-export.yaml å¯¼å‡º

### label

### service
kubectl expose depoyment web --port=80 --target-port=80 --dry-run=client -o yaml






- åˆ›å»ºåŸºç¡€yamlæ–‡ä»¶
kubectl create deployment nginx --image=nginx:1.16 -oyaml --dry-run=client > deploy.yaml
kubectl expose deployment nginx --port=80 --type=NodePort -oyaml --dry-run > svc.yaml

- åˆ›å»ºdeployment
kubectl create deployment java-demo --image=xx/java-demo --namespace=default --dry-run -oyaml > deployment.yaml

- åˆ›å»ºservicee
kubectl expose deployment java-demo --port=80 --target-port=8080 --type=NodePort -o yaml --dry-run=client > service.yaml


kubectl get po
kubectl get svc
kubectl get deploy

kubectl apply -f xxx.yaml


## ä½¿ç”¨deploymentéƒ¨ç½²æ— çŠ¶æ€åº”ç”¨
kubectl create deployment web --image=nginx:1.14
kubectl get deploy,pods

### å‡çº§
kubectl set image deployment/web nginx=nginx:1.15
kubectl rollout status deployment/nginx-deployment

### å›æ»š
kubectl rollout history deployment/web
kubectl rollout undo deployment/web
kubectl rollout undo deployment/web --revision=2

## delete
kubectl delete deploy/web
kubectl delete svc/web

## edit
kubectl edit deployment/web
kubectl edit svc/web


service > deployment > 


## pod

kubectl describe pod XXX -n kube-system
kubectl logs pod_name -c container-name       æŸ¥çœ‹podæ—¥å¿—
kubectl delete deployment xxxx                åˆ é™¤åº”ç”¨

kubectl scale deploy spark-worker-deployment --replicas=8       æ‰©å®¹

kkubectl delete pod -l app=flannel            æ ¹æ®labelåˆ é™¤pod

## How to make a k8s docker
docker inspect image-name:tag



## ref
- https://www.cnblogs.com/arvinhuang/p/16838874.html
- https://blog.csdn.net/weixin_41761624/article/details/108262772
- https://developer.aliyun.com/article/691997
- https://blog.csdn.net/huangbaokang/article/details/109675795 ç”Ÿæˆyamlé…ç½®æ–‡ä»¶
- http://www.sunrisenan.com/docs/boge/boge-1d5f9ck385qm3
- http://docs.kubernetes.org.cn/564.html å‘½ä»¤è¡Œåˆ›å»ºæœåŠ¡


## TODO
- å¦‚ä½•åˆ¶ä½œk8sé•œåƒ

