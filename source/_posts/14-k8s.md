---
title: 14-k8s
date: 2023-06-25 17:50:58
tags:
---

# k8s基础

## 概念与定义

- APIServer

- Controller-Manager
集群状态管理，保证Pod可用，和APIServer通信，负责创建/更新/删除资源。

- Scheduler
调度中心，根据一系列条件，选择节点，部署pod

- ETCD
键值数据库

- NODE

- kubelet
负责监听和上报节点上的Pod状态， 与Master节点通信并管理上面的pod

- kube-proxy
负责pod之间的通信和负责均衡，将指定的流量分发到后端正确的机器上.

- ipvs / iptables
ipvs 调用 netlink接口 创建ipvs规则。

- calico
符合CNI标准的网络插件, 给每一个pod生成一个唯一的IP地址，并把每个节点当作一个路由。

- CoreDNS
k8s内部集群service解析, 将service名称解析成IP地址，然后通过service的IP地址🔗到对应的应用上。

- Metrics-Server
采集容器数据


- pod
- service

- deployment
无状态应用部署

- statefulset
有状态应用部署

- daemonset

## 常用命令

### pod
kubectl get pod pod-name -o yaml > pod-name.yaml

### deployment
kubectl create deploy web --image=nginx -oyaml --dry-run=client > web-deploy.yaml 创建
kubectl get deploy web -oyaml > web-deploy-export.yaml 导出

### label

### service
kubectl expose depoyment web --port=80 --target-port=80 --dry-run=client -o yaml






- 创建基础yaml文件
kubectl create deployment nginx --image=nginx:1.16 -oyaml --dry-run=client > deploy.yaml
kubectl expose deployment nginx --port=80 --type=NodePort -oyaml --dry-run > svc.yaml

- 创建deployment
kubectl create deployment java-demo --image=xx/java-demo --namespace=default --dry-run -oyaml > deployment.yaml

- 创建servicee
kubectl expose deployment java-demo --port=80 --target-port=8080 --type=NodePort -o yaml --dry-run=client > service.yaml


kubectl get po
kubectl get svc
kubectl get deploy

kubectl apply -f xxx.yaml


## 使用deployment部署无状态应用
kubectl create deployment web --image=nginx:1.14
kubectl get deploy,pods

### 升级
kubectl set image deployment/web nginx=nginx:1.15
kubectl rollout status deployment/nginx-deployment

### 回滚
kubectl rollout history deployment/web
kubectl rollout undo deployment/web
kubectl rollout undo deployment/web --revision=2

## delete
kubectl delete deploy/web
kubectl delete svc/web

## edit
kubectl edit deployment/web
kubectl edit svc/web


service > deployment > 


## pod

kubectl describe pod XXX -n kube-system
kubectl logs pod_name -c container-name       查看pod日志
kubectl delete deployment xxxx                删除应用

kubectl scale deploy spark-worker-deployment --replicas=8       扩容

kkubectl delete pod -l app=flannel            根据label删除pod

## How to make a k8s docker
docker inspect image-name:tag



## ref
- https://www.cnblogs.com/arvinhuang/p/16838874.html
- https://blog.csdn.net/weixin_41761624/article/details/108262772
- https://developer.aliyun.com/article/691997
- https://blog.csdn.net/huangbaokang/article/details/109675795 生成yaml配置文件
- http://www.sunrisenan.com/docs/boge/boge-1d5f9ck385qm3
- http://docs.kubernetes.org.cn/564.html 命令行创建服务


## TODO
- 如何制作k8s镜像

